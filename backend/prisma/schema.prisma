
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(cuid())
  phone         String         @unique                 // 主要身份标识
  email         String?        @unique                 // 可选的辅助联系方式
  balance       Float          @default(0)          // 用户余额
  quotaLimit    Float          @default(0)          // API 调用配额限制（分钟）
  usedQuota     Float          @default(0)          // 已使用的配额
  status        String         @default("active")   // 用户状态：active/suspended
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  transactions  Transaction[]                       // 关联交易记录
  usageLogs     UsageLog[]                         // 关联使用记录
}

model Transaction {
  id          String    @id @default(cuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  type        String    // 'recharge' or 'consume'
  amount      Float
  description String?
  createdAt   DateTime  @default(now())
}

model UsageLog {
  id          String    @id @default(cuid())
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  type        String    // 'audio_transcription'
  duration    Float     // 音频时长（秒）
  tokens      Int       // API 调用消耗的 token 数
  cost        Float     // 计费金额
  status      String    // 'success' or 'failed'
  createdAt   DateTime  @default(now())
}
